<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Performance Analytics - AI Trading</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            background: #111217; 
            color: #d8d9da; 
            padding: 20px; 
            min-height: 100vh;
        }
        .container { max-width: 1600px; margin: 0 auto; }
        
        /* Navigation */
        .top-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 20px;
            background: #1f1f1f;
            border: 1px solid #343436;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        .nav-brand { font-size: 18px; font-weight: 600; color: #ff9830; }
        .nav-links { display: flex; gap: 8px; }
        .nav-links a {
            padding: 8px 16px;
            color: #d8d9da;
            text-decoration: none;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            background: transparent;
        }
        .nav-links a:hover { background: #343436; color: #fff; }
        .nav-links a.active { background: #5794f2; color: #fff; }
        .nav-links a.logout { background: rgba(242, 73, 92, 0.2); color: #f2495c; }
        .nav-links a.logout:hover { background: rgba(242, 73, 92, 0.3); }
        
        /* Header Info Bar */
        .info-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            background: #1f1f1f;
            border: 1px solid #343436;
            border-radius: 4px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 16px;
        }
        .page-title { font-size: 24px; font-weight: 600; color: #fff; }
        .regime-indicator {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 16px;
            background: #262628;
            border-radius: 4px;
        }
        .regime-label { font-size: 11px; text-transform: uppercase; letter-spacing: 1px; color: #8e8e8e; }
        .regime-value { font-size: 13px; font-weight: 600; padding: 4px 10px; border-radius: 4px; }
        .regime-params { font-size: 11px; color: #8e8e8e; }
        .regime-strong_bull { background: #73bf69; color: #111217; }
        .regime-bull { background: rgba(115, 191, 105, 0.7); color: #111217; }
        .regime-neutral { background: #8e8e8e; color: #111217; }
        .regime-bear { background: #ff9830; color: #111217; }
        .regime-strong_bear { background: #f2495c; color: #fff; }
        .regime-high_volatility { background: #b877d9; color: #fff; }
        .regime-unknown { background: #343436; color: #d8d9da; }
        .nyse-time { text-align: right; }
        .nyse-time .time-label { font-size: 11px; text-transform: uppercase; letter-spacing: 1px; color: #8e8e8e; display: block; }
        .nyse-time .time-value { font-size: 20px; font-weight: 600; font-family: 'Roboto Mono', monospace; color: #fff; display: block; }
        .nyse-time .time-date { font-size: 12px; color: #8e8e8e; display: block; }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 4px;
            margin-bottom: 20px;
            background: #1f1f1f;
            padding: 4px;
            border-radius: 4px;
            border: 1px solid #343436;
        }
        .tab {
            padding: 10px 20px;
            background: transparent;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
            font-weight: 500;
            color: #8e8e8e;
        }
        .tab:hover { background: #262628; color: #d8d9da; }
        .tab.active { background: #5794f2; color: #fff; }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: #1f1f1f;
            border: 1px solid #343436;
            border-radius: 4px;
            padding: 16px;
        }
        .stat-card .stat-label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #8e8e8e;
            margin-bottom: 8px;
        }
        .stat-card .stat-value {
            font-size: 26px;
            font-weight: 600;
            color: #fff;
        }
        .stat-card .stat-sub {
            font-size: 12px;
            color: #8e8e8e;
            margin-top: 4px;
        }
        .stat-value.green, .profit { color: #73bf69; }
        .stat-value.red, .loss { color: #f2495c; }

        /* Panel */
        .panel {
            background: #1f1f1f;
            border: 1px solid #343436;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        .panel-header {
            padding: 12px 16px;
            background: #262628;
            border-bottom: 1px solid #343436;
        }
        .panel-title { font-size: 14px; font-weight: 600; color: #d8d9da; }
        .panel-body { padding: 16px; }

        /* Table */
        table { width: 100%; border-collapse: collapse; }
        th {
            text-align: left;
            padding: 10px 12px;
            background: #262628;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 11px;
            letter-spacing: 0.5px;
            color: #8e8e8e;
            border-bottom: 1px solid #343436;
        }
        td {
            padding: 10px 12px;
            border-bottom: 1px solid #343436;
            font-size: 13px;
        }
        tbody tr:hover { background: rgba(87, 148, 242, 0.08); }

        /* Badges */
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }
        .badge-green { background: rgba(115, 191, 105, 0.2); color: #73bf69; }
        .badge-red { background: rgba(242, 73, 92, 0.2); color: #f2495c; }
        .badge-yellow { background: rgba(255, 152, 48, 0.2); color: #ff9830; }

        /* Recommendation */
        .recommendation {
            background: #262628;
            padding: 14px;
            border-left: 3px solid #5794f2;
            margin: 10px 0;
            border-radius: 0 4px 4px 0;
        }
        .recommendation.success { border-left-color: #73bf69; }
        .recommendation.warning { border-left-color: #ff9830; }
        .recommendation.error { border-left-color: #f2495c; }

        .empty { text-align: center; padding: 40px; color: #6e6e6e; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Navigation -->
        <nav class="top-nav">
            <div class="nav-brand">AI Trader</div>
            <div class="nav-links">
                <a href="/">Dashboard</a>
                <a href="/analysis">Analysis</a>
                <a href="/performance" class="active">Performance</a>
                <a href="/optimizer">Optimizer</a>
                <a href="/monitoring">Metrics</a>
                <a href="/grafana">Grafana</a>
                <a href="/logout" class="logout">Logout</a>
            </div>
        </nav>

        <!-- Info Bar -->
        <div class="info-bar">
            <div class="page-title">Performance Analytics</div>
            <div class="regime-indicator" id="regime-indicator" title="Current market regime and adaptive trading parameters">
                <span class="regime-label">Regime</span>
                <span class="regime-value regime-unknown" id="regime-value">Loading...</span>
                <span class="regime-params" id="regime-params">SL: --% | TP: --% | Min: --</span>
            </div>
            <div class="nyse-time">
                <span class="time-label">NYSE Time (ET)</span>
                <span class="time-value" id="nyse-time">--:--:--</span>
                <span class="time-date" id="nyse-date">Loading...</span>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="showTab('overview')">Overview</button>
            <button class="tab" onclick="showTab('trades')">Recent Trades</button>
            <button class="tab" onclick="showTab('scores')">Score Analysis</button>
            <button class="tab" onclick="showTab('exits')">Exit Analysis</button>
        </div>

        <!-- Overview Tab -->
        <div id="tab-overview">
            <div id="error-banner" style="display:none; background:#f2495c; color:white; padding:12px 16px; border-radius:4px; margin-bottom:16px;"></div>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Total Trades</div>
                    <div class="stat-value" id="total-trades">-</div>
                    <div class="stat-sub" id="trade-period">Loading...</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Win Rate</div>
                    <div class="stat-value" id="win-rate">0%</div>
                    <div class="stat-sub"><span id="winning-trades">0</span> wins / <span id="losing-trades">0</span> losses</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Net Profit</div>
                    <div class="stat-value" id="net-profit">$0.00</div>
                    <div class="stat-sub">Profit Factor: <span id="profit-factor">0.00</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Sharpe Ratio</div>
                    <div class="stat-value" id="sharpe-ratio">0.00</div>
                    <div class="stat-sub">Risk-adjusted returns</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Avg Profit/Trade</div>
                    <div class="stat-value green" id="avg-profit-winning">$0.00</div>
                    <div class="stat-sub">Winners</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Avg Loss/Trade</div>
                    <div class="stat-value red" id="avg-loss-losing">$0.00</div>
                    <div class="stat-sub">Losers</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Avg Hold Time</div>
                    <div class="stat-value" id="avg-hold-time">0h</div>
                    <div class="stat-sub">Per trade</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Max Drawdown</div>
                    <div class="stat-value red" id="max-drawdown">$0.00</div>
                    <div class="stat-sub">Largest loss streak</div>
                </div>
            </div>

            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">Best & Worst Trades</div>
                </div>
                <div class="panel-body" id="best-worst-trades"></div>
            </div>
        </div>

        <!-- Trades Tab -->
        <div id="tab-trades" style="display:none;">
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">Recent Trades (Last 20)</div>
                </div>
                <div class="panel-body" id="recent-trades-table"></div>
            </div>
        </div>

        <!-- Scores Tab -->
        <div id="tab-scores" style="display:none;">
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">Score Correlation Analysis</div>
                </div>
                <div class="panel-body" id="score-correlation"></div>
            </div>

            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">Performance by Score Range</div>
                </div>
                <div class="panel-body" id="score-ranges"></div>
            </div>

            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">Recommendations</div>
                </div>
                <div class="panel-body" id="recommendations"></div>
            </div>
        </div>

        <!-- Exit Analysis Tab -->
        <div id="tab-exits" style="display:none;">
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">Performance by Exit Reason</div>
                </div>
                <div class="panel-body" id="exit-analysis"></div>
            </div>
        </div>
    </div>

    <script>
        function showTab(tabName) {
            document.querySelectorAll('[id^="tab-"]').forEach(el => el.style.display = 'none');
            document.getElementById('tab-' + tabName).style.display = 'block';
            document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
            event.target.classList.add('active');
        }

        function formatCurrency(value) {
            return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(value);
        }

        function formatPercent(value) {
            return value.toFixed(2) + '%';
        }

        function formatDuration(minutes) {
            const hours = Math.floor(minutes / 60);
            const mins = Math.floor(minutes % 60);
            if (hours > 24) {
                const days = Math.floor(hours / 24);
                return `${days}d ${hours % 24}h`;
            }
            return `${hours}h ${mins}m`;
        }

        function formatDateTime(isoString) {
            if (!isoString) return '-';
            const date = new Date(isoString);
            return date.toLocaleDateString('en-US', { 
                month: 'short', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function formatDate(isoString) {
            if (!isoString) return '-';
            const date = new Date(isoString);
            return date.toLocaleDateString('en-US', { 
                month: 'short', 
                day: 'numeric',
                year: 'numeric'
            });
        }

        async function fetchWithAuth(url, options = {}) {
            try {
                const controller = new AbortController();
                const timeout = setTimeout(() => controller.abort(), 10000); // 10 second timeout
                
                const response = await fetch(url, { 
                    ...options, 
                    signal: controller.signal,
                    credentials: 'same-origin'
                });
                clearTimeout(timeout);
                
                if (response.status === 401) {
                    window.location.href = '/login';
                    throw new Error('Authentication required');
                }
                return response;
            } catch (error) {
                if (error.name === 'AbortError') {
                    throw new Error('Request timed out');
                }
                console.error('Fetch error for', url, ':', error);
                throw error;
            }
        }

        async function loadMetrics() {
            const tradePeriod = document.getElementById('trade-period');
            const errorBanner = document.getElementById('error-banner');
            try {
                console.log('Loading performance stats from:', window.location.origin + '/api/performance/stats');
                tradePeriod.textContent = 'Loading...';
                errorBanner.style.display = 'none';
                
                const response = await fetchWithAuth('/api/performance/stats');
                console.log('Response status:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('Metrics data:', data);
                
                // Handle error responses
                if (data.error) {
                    console.error('API error:', data.error);
                    tradePeriod.textContent = 'API Error: ' + data.error;
                    return;
                }
                
                if (data.total_trades === 0 || data.total_trades === undefined) {
                    document.getElementById('total-trades').textContent = '0';
                    tradePeriod.textContent = data.message || 'No trades yet - start trading to see performance!';
                    return;
                }
                
                tradePeriod.textContent = 'All time';
                document.getElementById('total-trades').textContent = data.total_trades;
                document.getElementById('winning-trades').textContent = data.winning_trades;
                document.getElementById('losing-trades').textContent = data.losing_trades;
                document.getElementById('win-rate').textContent = formatPercent(data.win_rate);
                
                const netProfit = document.getElementById('net-profit');
                netProfit.textContent = formatCurrency(data.net_profit);
                netProfit.className = data.net_profit >= 0 ? 'stat-value green' : 'stat-value red';
                
                document.getElementById('profit-factor').textContent = data.profit_factor === Infinity ? '∞' : data.profit_factor.toFixed(2);
                document.getElementById('sharpe-ratio').textContent = data.sharpe_ratio.toFixed(2);
                document.getElementById('avg-profit-winning').textContent = formatCurrency(data.avg_profit_per_winning_trade);
                document.getElementById('avg-loss-losing').textContent = formatCurrency(data.avg_loss_per_losing_trade);
                document.getElementById('avg-hold-time').textContent = formatDuration(data.avg_hold_time_min);
                document.getElementById('max-drawdown').textContent = formatCurrency(data.max_drawdown);

                const bestWorst = document.getElementById('best-worst-trades');
                bestWorst.innerHTML = `
                    <table>
                        <tr>
                            <th>Type</th>
                            <th>Symbol</th>
                            <th>Entry</th>
                            <th>Exit</th>
                            <th>P/L</th>
                            <th>P/L %</th>
                            <th>Score</th>
                        </tr>
                        <tr>
                            <td><span class="badge badge-green">BEST</span></td>
                            <td><strong>${data.best_trade.symbol}</strong></td>
                            <td>${formatCurrency(data.best_trade.entry_price)}</td>
                            <td>${formatCurrency(data.best_trade.exit_price)}</td>
                            <td class="profit">${formatCurrency(data.best_trade.profit_loss)}</td>
                            <td class="profit">${formatPercent(data.best_trade.profit_loss_pct)}</td>
                            <td>${data.best_trade.entry_score.composite.toFixed(1)}</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-red">WORST</span></td>
                            <td><strong>${data.worst_trade.symbol}</strong></td>
                            <td>${formatCurrency(data.worst_trade.entry_price)}</td>
                            <td>${formatCurrency(data.worst_trade.exit_price)}</td>
                            <td class="loss">${formatCurrency(data.worst_trade.profit_loss)}</td>
                            <td class="loss">${formatPercent(data.worst_trade.profit_loss_pct)}</td>
                            <td>${data.worst_trade.entry_score.composite.toFixed(1)}</td>
                        </tr>
                    </table>
                `;

            } catch (error) {
                console.error('Failed to load metrics:', error);
                const errorBanner = document.getElementById('error-banner');
                errorBanner.innerHTML = `
                    <strong>Failed to load metrics:</strong> ${error.message}<br>
                    <small>URL: ${window.location.origin}/api/performance/stats</small><br>
                    <small>Try refreshing the page or check browser console (F12) for details.</small>
                `;
                errorBanner.style.display = 'block';
                document.getElementById('trade-period').textContent = 'Error';
                document.getElementById('total-trades').textContent = '!';
            }
        }

        async function loadRecentTrades() {
            try {
                const response = await fetchWithAuth('/api/performance/recent-trades');
                const trades = await response.json();
                
                const container = document.getElementById('recent-trades-table');
                
                // Handle error responses
                if (trades.error) {
                    container.innerHTML = '<div class="empty">Error loading trades</div>';
                    return;
                }
                
                if (!Array.isArray(trades) || trades.length === 0) {
                    container.innerHTML = '<div class="empty">No trades recorded yet</div>';
                    return;
                }

                let html = '<table><thead><tr><th>Symbol</th><th>Entry Date</th><th>Exit Date</th><th>Entry $</th><th>Exit $</th><th>Hold Time</th><th>P/L</th><th>P/L %</th><th>Score</th><th>Exit Reason</th></tr></thead><tbody>';
                
                for (const trade of trades) {
                    const plClass = trade.profit_loss >= 0 ? 'profit' : 'loss';
                    html += `<tr>
                        <td><strong>${trade.symbol}</strong></td>
                        <td>${formatDateTime(trade.entry_time)}</td>
                        <td>${formatDateTime(trade.exit_time)}</td>
                        <td>${formatCurrency(trade.entry_price)}</td>
                        <td>${formatCurrency(trade.exit_price)}</td>
                        <td>${formatDuration(trade.hold_duration_min)}</td>
                        <td class="${plClass}">${formatCurrency(trade.profit_loss)}</td>
                        <td class="${plClass}">${formatPercent(trade.profit_loss_pct)}</td>
                        <td>${trade.entry_score.composite.toFixed(1)}</td>
                        <td><span class="badge badge-yellow">${trade.exit_reason}</span></td>
                    </tr>`;
                }
                
                html += '</tbody></table>';
                container.innerHTML = html;

            } catch (error) {
                console.error('Failed to load trades:', error);
            }
        }

        async function loadScoreAnalysis() {
            try {
                const response = await fetchWithAuth('/api/performance/score-analysis');
                const data = await response.json();
                
                if (data.status === 'insufficient_data') {
                    document.getElementById('score-correlation').innerHTML = `
                        <div class="empty">Need at least ${data.min_required} trades for score analysis (currently have ${data.current})</div>
                    `;
                    return;
                }

                document.getElementById('score-correlation').innerHTML = `
                    <div style="margin-bottom: 20px;">
                        <div style="font-size: 42px; font-weight: 700; color: ${Math.abs(data.overall_correlation) > 0.5 ? '#73bf69' : '#ff9830'};">
                            ${data.overall_correlation.toFixed(3)}
                        </div>
                        <div style="font-size: 16px; color: #8e8e8e; margin-top: 10px;">
                            ${data.interpretation} correlation between entry scores and profitability
                        </div>
                        <div style="margin-top: 20px; color: #d8d9da;">
                            <strong>Component Correlations:</strong><br>
                            <span style="color: #8e8e8e;">Technical:</span> ${data.component_correlations.technical != null ? data.component_correlations.technical.toFixed(3) : 'N/A'}<br>
                            <span style="color: #8e8e8e;">Sentiment:</span> ${data.component_correlations.sentiment != null ? data.component_correlations.sentiment.toFixed(3) : 'N/A'}<br>
                            <span style="color: #8e8e8e;">Fundamental:</span> ${data.component_correlations.fundamental != null ? data.component_correlations.fundamental.toFixed(3) : 'N/A (no variance)'}
                        </div>
                    </div>
                `;

                let rangesHtml = '<table><thead><tr><th>Score Range</th><th>Trades</th><th>Win Rate</th><th>Avg Profit %</th><th>Total Profit</th></tr></thead><tbody>';
                for (const [range, stats] of Object.entries(data.score_ranges)) {
                    rangesHtml += `<tr>
                        <td><strong>${range}</strong></td>
                        <td>${stats.count}</td>
                        <td>${formatPercent(stats.win_rate)}</td>
                        <td class="${stats.avg_profit_pct >= 0 ? 'profit' : 'loss'}">${formatPercent(stats.avg_profit_pct)}</td>
                        <td class="${stats.total_profit >= 0 ? 'profit' : 'loss'}">${formatCurrency(stats.total_profit)}</td>
                    </tr>`;
                }
                rangesHtml += '</tbody></table>';
                document.getElementById('score-ranges').innerHTML = rangesHtml;

                let recHtml = '';
                for (const rec of data.recommendation) {
                    const type = rec.includes('✅') ? 'success' : rec.includes('⚠️') ? 'warning' : 'error';
                    recHtml += `<div class="recommendation ${type}">${rec}</div>`;
                }
                document.getElementById('recommendations').innerHTML = recHtml;

            } catch (error) {
                console.error('Failed to load score analysis:', error);
            }
        }

        async function loadExitAnalysis() {
            try {
                const response = await fetchWithAuth('/api/performance/exit-analysis');
                const data = await response.json();
                
                if (data.message) {
                    document.getElementById('exit-analysis').innerHTML = `<div class="empty">${data.message}</div>`;
                    return;
                }

                let html = '<table><thead><tr><th>Exit Reason</th><th>Trades</th><th>Win Rate</th><th>Avg Profit</th><th>Avg Profit %</th><th>Total Profit</th></tr></thead><tbody>';
                
                for (const [reason, stats] of Object.entries(data)) {
                    html += `<tr>
                        <td><span class="badge badge-yellow">${reason}</span></td>
                        <td>${stats.count}</td>
                        <td>${formatPercent(stats.win_rate)}</td>
                        <td class="${stats.avg_profit >= 0 ? 'profit' : 'loss'}">${formatCurrency(stats.avg_profit)}</td>
                        <td class="${stats.avg_profit_pct >= 0 ? 'profit' : 'loss'}">${formatPercent(stats.avg_profit_pct)}</td>
                        <td class="${stats.total_profit >= 0 ? 'profit' : 'loss'}">${formatCurrency(stats.total_profit)}</td>
                    </tr>`;
                }
                
                html += '</tbody></table>';
                document.getElementById('exit-analysis').innerHTML = html;

            } catch (error) {
                console.error('Failed to load exit analysis:', error);
            }
        }

        // Load all data
        console.log('Performance page initialized, loading data...');
        loadMetrics();
        loadRecentTrades();
        loadScoreAnalysis();
        loadExitAnalysis();

        // Auto-refresh
        setInterval(() => {
            loadMetrics();
            loadRecentTrades();
            loadScoreAnalysis();
            loadExitAnalysis();
        }, 5000);

        // NYSE Time
        function updateNYSETimeLocal() {
            const now = new Date();
            const options = { 
                timeZone: 'America/New_York',
                hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true
            };
            const dateOptions = {
                timeZone: 'America/New_York',
                weekday: 'short', month: 'short', day: 'numeric', year: 'numeric'
            };
            document.getElementById('nyse-time').textContent = now.toLocaleTimeString('en-US', options);
            document.getElementById('nyse-date').textContent = now.toLocaleDateString('en-US', dateOptions);
        }
        updateNYSETimeLocal();
        setInterval(updateNYSETimeLocal, 1000);

        // Regime indicator
        async function updateRegime() {
            try {
                const response = await fetch('/api/status');
                const data = await response.json();
                if (data.regime) {
                    const regime = data.regime;
                    const regimeValue = document.getElementById('regime-value');
                    const regimeParams = document.getElementById('regime-params');
                    
                    const regimeDisplay = {
                        'strong_bull': 'STRONG BULL', 'bull': 'BULL', 'neutral': 'NEUTRAL',
                        'bear': 'BEAR', 'strong_bear': 'STRONG BEAR', 'high_volatility': 'HIGH VOL',
                        'unknown': 'UNKNOWN', 'error': 'ERROR'
                    };
                    
                    const regimeName = regime.regime || 'unknown';
                    regimeValue.textContent = regimeDisplay[regimeName] || regimeName.toUpperCase();
                    regimeValue.className = `regime-value regime-${regimeName}`;
                    
                    const slPct = ((regime.stop_loss_pct || 0.03) * 100).toFixed(0);
                    const tpPct = ((regime.take_profit_pct || 0.08) * 100).toFixed(0);
                    const minScore = regime.min_score || 70;
                    regimeParams.textContent = `SL: ${slPct}% | TP: ${tpPct}% | Min: ${minScore}`;
                }
            } catch (e) { console.error('Regime fetch error:', e); }
        }
        updateRegime();
        setInterval(updateRegime, 10000);
    </script>
</body>
</html>
